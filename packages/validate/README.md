# Validate

Client-side form validation library to support .NET MVC (core) unobtrusive validation using data-val attributes and HTML5 attribute-based constraint validation.


## Usage
JS
```
npm i -S @storm/validate
```
```
import Validate from '@storm/validate';

const validator = Validate.init('form:not([novalidate])');
```

HTML

Can be HTML5 or use the data-val attributes generated by .Net Core model validation, .Net MVC DataAnnotation, or .Net Fluent validation libraries.


### Required
The field must have a value

HTML5
```
<input name="field" id="field" required>
```
.Net
```
<input name="field" id="field" data-val="true" data-val-required="'field' is required">
```

### Email
The value is validated against the regular expression
```
/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/
```
which is equivalent to the browser algorithm used in the constraint validation API for type="email", and is intentionally loose due to [known issues](https://www.w3.org/Bugs/Public/show_bug.cgi?id=15489) related to international domain names and the validation of e-mail addresses in HTML. Stricter or more specific validation rules can be specified with a pattern attribute (or data-val-regex with .Net).

HTML5
```
<input type="email" name="field" id="field">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-email="'field' must be a valid email address">
```

### Url
The value is validated against the [regular expresion by Diego Perini](https://mathiasbynens.be/demo/url-regex)
```
/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i
```
Stricter or more specific validation rules can be specified with a pattern attribute (or data-val-regex with .Net).

HTML5
```
<input type="url" name="field" id="field">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-url="'field' must be a valid url">
```


### Pattern (regex)
The value matches the supplied pattern or regular expression

HTML5
```
<input name="field" id="field" pattern="^http(s)?">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-regex="'field' must start with http or https" data-val-regex-pattern="^http(s)?">
```

### Digits
Value must contain only characters in the range 0-9

.Net
```
<input name="field" id="field" data-val="true" data-val-digits="'field' must be a number">
```


### Number
The value is validated against the regular expresion
```
/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;
```

HTML5
```
<input type="number" name="field" id="field">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-number="'field' must be a number">
```

### Min
Value is a Number greater or equal to min

HTML5
```
<input type="number" name="field" id="field" min="0">
```
.Net
```
<input type="number" name="field" id="field" data-val="true" data-val-min="'field' must be >= 0" data-val-min-min="0">
```

### Max
Value is a Number less than or equal to max

HTML5
```
<input type="number" name="field" id="field" max="100">
```
.Net
```
<input type="number" name="field" id="field" data-val="true" data-val-max="'field' must be <= 100" data-val-max-max="100">
```

### Range
Value is a Number within the specified min and max

.Net
```
<input type="number" name="field" id="field" data-val="true" data-val-range="'field' must be between 0 and 100" data-val-range-min="0" data-val-range-max="100">
```

### Length
Value is a String with a length greater than or equal to min and/or a length less than or equal to max

.Net
```
<input name="field" id="field" data-val="true" data-val-length="'field' length must be between 2 and 4" data-val-length-min="2" data-val-length-max="4">
```

### Stringlength
Value is a String with a length less than or equal to max. Equivalent to the length/max validator, generated by .Net stringlength data notation.

.Net
```
<input name="field" id="field" data-val="true" data-val-stringlength="'field' length must be less than 4" data-val-stringlength-max="4">
```

### Maxlength
Value is a String with a length less than or equal to max. Equivalent to the length/max validator, generated by .Net maxlength data notation.

.Net
```
<input name="field" id="field" data-val="true" data-val-maxlength="'field' length must be less than 4" data-val-maxlength-max="4">
```

### Minlength
Value is a String with a length greater than or equal to min. Equivalent to the length/min validator, generated by .Net minlength data notation.

.Net
```
<input name="field" id="field" data-val="true" data-val-minlength="'field' length must be greater than 2" data-val-minlength-min="2">
```


<!-- 
dateISO
custom
equalto
remote -->






## Error messages

dom node
.Net libraries generate
```
<span class="field-validation-valid" data-valmsg-for="field" data-valmsg-replace="true" />
```
HTML5 default error messages

.Net error messages in data-val-[validator-type] data attributes



HTML
```
<form action="./">
    <!-- Any form with inputs containing HTML validation attributes -->
	<input type="text" name="field-1" id="field-1" required>
	<input type="email" name="field-2" id="field-2" required>
	<input type="text" name="field-3" id="field-3" pattern="\d*" required>
    
    <!-- or .NET MVC-generated data-val attributes -->
    <input type="text" data-val="true" data-val-required="The Required String field is required." name="field-4" id="field-4" />
	<!-- The server-rendered span is recycled by the library to render errors -->
    <span style="color: red" class="field-validation-valid" data-valmsg-for="field-4" data-valmsg-replace="true" />
    <input type="submit">
</div>
```
JS
```
npm i -S @storm/validate
```
```
import Validate from '@storm/validate';

const validator = Validate.init('form');

```
## API

1. addMethod - to add a custom validation method:
```
const validators = Validate.init('.my-form');

validators[0].addMethod(
    'MyFieldName', //input/input group name
    (value, fields, params) => { //validation method
        return value === 'test'; //must return boolean
    },
    'Value must equal "test"' //error message on validation failure
);
```

2. validate - to manually trigger validation on the whole form:
```
const validators = Validate.init('.my-form');

validators[0].validate();
```

3. addGroup - add an input or input validation group
```
const validators = Validate.init('.my-form');
const fieldsArray = Array.from(document.querySelector('.new-fields'))

//add by passing an array of fields
//if these fields span multiple groups they will be collected into the correct validation groups internally by the validator
validators[0].addGroup(fieldsArray);
```

4. removeGroup - remove a validation group
```
const validators = Validate.init('.my-form');
const fieldsArray = Array.from(document.querySelectorAll([name=new-fields]))

//add by passing an array of fields
validators[0].addGroup(fieldsArray);

//remove by passing the name of a group
validators[0].removeGroup('new-fields');
```


## Tests
```
npm t
```

## License
MIT
