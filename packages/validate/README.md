# Validate

Client-side form validation library to support .NET MVC (core) validation using data-val attributes as a drop-in replacement for jQuery validate, and HTML5 attribute-based constraint validation.


## Usage
JS
```
npm i -S @storm/validate
```
```
import Validate from '@storm/validate';

//returns an array of instances for every selector matched
//also support passing an element as the first argument
const [ validator ] = Validate.init('form:not([novalidate])');
```

HTML

HTML5 or the data-val attributes generated by .Net Core model validation, .Net MVC DataAnnotation, or .Net Fluent validation libraries are supported.

The HTML for each validator type is outlined below, naturally, multiple validators can be used on a single field.


### Required
The field must have a value. Checkboxes are treated non-nullable in required validation.

HTML5
```
<input name="field" id="field" required>
```
.Net
```
<input name="field" id="field" data-val="true" data-val-required="'field' is required">
```

### Email
Value is matched against the regular expression
```
/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/
```
which is equivalent to the browser algorithm used in the constraint validation API for type="email", and is intentionally loose due to [known issues](https://www.w3.org/Bugs/Public/show_bug.cgi?id=15489) related to international domain names and the validation of e-mail addresses in HTML. Stricter or more specific validation rules can be specified with a pattern attribute (or data-val-regex with .Net).

HTML5
```
<input type="email" name="field" id="field">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-email="'field' must be a valid email address">
```

### Url
The value is matched against this [regular expresion by Diego Perini](https://mathiasbynens.be/demo/url-regex)
```
/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i
```
Stricter or more specific validation rules can be specified with a pattern attribute (or data-val-regex with .Net).

HTML5
```
<input type="url" name="field" id="field">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-url="'field' must be a valid url">
```


### Pattern (regex)
Value matches the supplied pattern or regular expression

HTML5
```
<input name="field" id="field" pattern="^http(s)?">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-regex="'field' must start with http or https" data-val-regex-pattern="^http(s)?">
```

### Digits
Value must contain only characters in the range 0-9

.Net
```
<input name="field" id="field" data-val="true" data-val-digits="'field' must be a number">
```


### Number
Value is matched against the regular expresion
```
/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;
```

Allowing positive and negative numbers, decimals, and comma separated thousands.

HTML5
```
<input type="number" name="field" id="field">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-number="'field' must be a number">
```

### Min
Value is a Number greater or equal to min

HTML5
```
<input type="number" name="field" id="field" min="0">
```
.Net
```
<input type="number" name="field" id="field" data-val="true" data-val-min="'field' must be >= 0" data-val-min-min="0">
```

### Max
Value is a Number less than or equal to max

HTML5
```
<input type="number" name="field" id="field" max="100">
```
.Net
```
<input type="number" name="field" id="field" data-val="true" data-val-max="'field' must be <= 100" data-val-max-max="100">
```

### Range
Value is a Number within the specified min and max

.Net
```
<input type="number" name="field" id="field" data-val="true" data-val-range="'field' must be between 0 and 100" data-val-range-min="0" data-val-range-max="100">
```

### Length
Value is a String with a length greater than or equal to min and/or a length less than or equal to max

.Net
```
<input name="field" id="field" data-val="true" data-val-length="'field' length must be between 2 and 4" data-val-length-min="2" data-val-length-max="4">
```

### Stringlength
Value is a String with a length less than or equal to max. Equivalent to the length/max validator, generated by .Net stringlength data notation.

.Net
```
<input name="field" id="field" data-val="true" data-val-stringlength="'field' length must be less than 4" data-val-stringlength-max="4">
```

### Maxlength
Value is a String with a length less than or equal to max. Equivalent to the length/max validator, generated by .Net maxlength data notation.

.HTML5
```
<input name="field" id="field" maxlength="4">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-maxlength="'field' length must be less than 4" data-val-maxlength-max="4">
```

### Minlength
Value is a String with a length greater than or equal to min. Equivalent to the length/min validator, generated by .Net minlength data notation.

.HTML5
```
<input name="field" id="field" minlength="2">
```
.Net
```
<input name="field" id="field" data-val="true" data-val-minlength="'field' length must be greater than 2" data-val-minlength-min="2">
```


### dateISO
Value is a string in a format matching the [date ISO standard](https://en.wikipedia.org/wiki/ISO_8601), (YYYY-MM-DD), matching the regular expression
```
/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/
```

.Net
```
<input name="field" id="field" data-val="true" data-val-dateISO="'field' must in the format YYYY-MM-DD">
```

### equalto
Value must match the value of another field (or multiple fields). The data-val-equalto-other attribute is the id of another field, or a comma-separated list of ids of multiple fields.

.Net
```
<input name="password" id="password">
...
<input name="passwordConfirmation" id="passwordConfirmation" data-val="true" data-val-equalto="'password confirmation' must match 'password'" data-val-equalto-other="password">
```

### remote
Value is validated against via XHR against a remote resource. The resouce is defined by the `data-val-remote-url` attribute.

Defaults to a POST request, `data-val-remote-type` can be set to make GET requests.

The values of additional fields can be sent in the request by specifying a `data-val-remote-additionalfields` attribute, a comma separated list of field ids to be included.

.Net
```
<input name="field" id="field" data-val="true" data-val-remote="'field' must pass remote validation" data-val-remote-url="/api/validate">
```


## Errors

### Error message node
The element to contain error messages generated by .Net libraries is recycyled by this library
```
<span class="field-validation-valid" data-valmsg-for="field" data-valmsg-replace="true" />
```

If this element is not present a span is appended to the label for the field with the className `.error-message`.


### Error messages
.Net error messages are extracted from data-val-[validator-type] data attributes, and apply to both HTML5 and .Net validators.

Fields without data-val error messages will show the default messages for the failed validator (see options below).


## Options

```
{
    preSubmitHook: false, //function, called on validation pass, before submit
    submit: form.submit, // function, to support async form submissions, pass your own submit function
    messages: { //default HTML5 error messages
        required() { return 'This field is required'; } ,
        email() { return 'Please enter a valid email address'; },
        pattern() { return 'The value must match the pattern'; },
        url(){ return 'Please enter a valid URL'; },
        number() { return 'Please enter a valid number'; },
        digits() { return 'Please enter only digits'; },
        maxlength(props) { return `Please enter no more than ${props.max} characters`; },
        minlength(props) { return `Please enter at least ${props.min} characters`; },
        max(props){ return `Please enter a value less than or equal to ${props.max}`; },
        min(props){ return `Please enter a value greater than or equal to ${props.min}`}
    }
}
```

## API

### addMethod
Add a custom validation method:
```
const [ validators ] = Validate.init('.my-form');

validators.addMethod(
    'MyFieldName', //input/input group name
    (value, fields, params) => { //validation method
        return value === 'test'; //must return boolean
    },
    'Value must equal "test"' //error message on validation failure
);
```

### validate
Manually trigger validation on the whole form, returns a promise:
```
const [ validators ] = Validate.init('.my-form');

await validators.validate();
```

### addGroup
add an input or input validation group
```
const [ validators ] = Validate.init('.my-form');
const fieldsArray = Array.from(document.querySelector('.new-fields'))

//add by passing an array of fields
//if these fields span multiple groups they will be collected into the correct validation groups internally by the validator
validators.addGroup(fieldsArray);
```

### removeGroup
remove a validation group
```
const [ validators ] = Validate.init('.my-form');
const fieldsArray = Array.from(document.querySelectorAll([name=new-fields]))

//add by passing an array of fields
validators.addGroup(fieldsArray);

//remove by passing the name of a group
validators.removeGroup('new-fields');
```


## Tests
```
npm t
```

## License
MIT
